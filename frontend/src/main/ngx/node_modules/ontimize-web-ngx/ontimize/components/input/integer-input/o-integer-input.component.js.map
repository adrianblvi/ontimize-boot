{"version":3,"file":"o-integer-input.component.js","sourceRoot":"","sources":["../../../../../tmp/ontimize/components/input/integer-input/o-integer-input.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { CommonModule } from '@angular/common';\nimport { AfterViewInit, Component, ElementRef, forwardRef, Inject, Injector, NgModule, OnInit, Optional, ViewEncapsulation } from '@angular/core';\nimport { FormControl, ValidationErrors, ValidatorFn } from '@angular/forms';\n\nimport { InputConverter } from '../../../decorators';\nimport { IIntegerPipeArgument, OIntegerPipe } from '../../../pipes';\nimport { OSharedModule } from '../../../shared';\nimport { Util } from '../../../util/util';\nimport { OFormComponent } from '../../form/o-form.component';\nimport { IFormValueOptions, OFormValue } from '../../form/OFormValue';\nimport { DEFAULT_INPUTS_O_TEXT_INPUT, DEFAULT_OUTPUTS_O_TEXT_INPUT, OTextInputComponent, OTextInputModule } from '../text-input/o-text-input.component';\n\nexport const DEFAULT_INPUTS_O_INTEGER_INPUT = [\n  ...DEFAULT_INPUTS_O_TEXT_INPUT,\n  'min',\n  'max',\n  'step',\n  'grouping',\n  'thousandSeparator : thousand-separator',\n  'olocale : locale'\n];\n\nexport const DEFAULT_OUTPUTS_O_INTEGER_INPUT = [\n  ...DEFAULT_OUTPUTS_O_TEXT_INPUT\n];\n\n@Component({\n  moduleId: module.id,\n  selector: 'o-integer-input',\n  template: `\n    <div [formGroup]=\"getFormGroup()\" [matTooltip]=\"tooltip\" [matTooltipClass]=\"tooltipClass\" [matTooltipPosition]=\"tooltipPosition\"\n      [matTooltipShowDelay]=\"tooltipShowDelay\" [matTooltipHideDelay]=\"tooltipHideDelay\">\n      <mat-form-field [appearance]=\"appearance\" [floatLabel]=\"floatLabel\"  [hideRequiredMarker]=\"hideRequiredMarker\" [class.custom-width]=\"hasCustomWidth\"\n        [class.icon-field]=\"showClearButton\" fxFlexFill>\n        <mat-label *ngIf=\"labelVisible\">{{ olabel | oTranslate }}</mat-label>\n        <input matInput [type]=\"inputType\" [id]=\"getAttribute()\" [formControlName]=\"getAttribute()\" [placeholder]=\"placeHolder\"\n          (focus)=\"innerOnFocus($event)\" (blur)=\"innerOnBlur($event)\" (change)=\"onChangeEvent($event)\" [readonly]=\"isReadOnly\"\n          [min]=\"min\" [max]=\"max\" [step]=\"step\" [required]=\"isRequired\">\n        <button type=\"button\" *ngIf=\"showClearButton\" matSuffix mat-icon-button (click)=\"onClickClearValue($event)\">\n          <mat-icon svgIcon=\"ontimize:close\"></mat-icon>\n        </button>\n        <mat-error *ngIf=\"hasError('required')\" text=\"{{ 'FORM_VALIDATION.REQUIRED' | oTranslate }}\"></mat-error>\n        <mat-error *ngIf=\"hasError('min')\" text=\"{{ 'FORM_VALIDATION.MIN_VALUE' | oTranslate }}: {{ getErrorValue('min', 'requiredMin') }}\"></mat-error>\n        <mat-error *ngIf=\"hasError('max')\" text=\"{{ 'FORM_VALIDATION.MAX_VALUE' | oTranslate }}: {{ getErrorValue('max', 'requiredMax') }}\"></mat-error>\n        <mat-error *ngFor=\"let oError of getActiveOErrors()\" text=\"{{ oError.text | oTranslate }}\"></mat-error>\n      </mat-form-field>\n    </div>\n  `,\n  styles: [`\n\n  `],\n  inputs: DEFAULT_INPUTS_O_INTEGER_INPUT,\n  outputs: DEFAULT_OUTPUTS_O_INTEGER_INPUT,\n  encapsulation: ViewEncapsulation.None\n})\nexport class OIntegerInputComponent extends OTextInputComponent implements AfterViewInit, OnInit {\n\n  public static DEFAULT_INPUTS_O_INTEGER_INPUT = DEFAULT_INPUTS_O_INTEGER_INPUT;\n  public static DEFAULT_OUTPUTS_O_INTEGER_INPUT = DEFAULT_OUTPUTS_O_INTEGER_INPUT;\n\n  inputType: string = 'number';\n\n  @InputConverter()\n  min: number;\n  @InputConverter()\n  max: number;\n  @InputConverter()\n  step: number = 1;\n\n  @InputConverter()\n  protected grouping: boolean = false;\n  protected thousandSeparator: string;\n  protected olocale: string;\n\n  protected componentPipe: OIntegerPipe;\n  protected pipeArguments: IIntegerPipeArgument;\n\n  constructor(\n    @Optional() @Inject(forwardRef(() => OFormComponent)) form: OFormComponent,\n    elRef: ElementRef,\n    injector: Injector\n  ) {\n    super(form, elRef, injector);\n    this._defaultSQLTypeKey = 'INTEGER';\n\n    // Firefox workaround\n    if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {\n      this.inputType = 'text';\n    }\n\n    this.setComponentPipe();\n  }\n\n  initialize(): void {\n    super.initialize();\n    this.initializeStep();\n  }\n\n  setComponentPipe() {\n    this.componentPipe = new OIntegerPipe(this.injector);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.pipeArguments = {\n      grouping: this.grouping,\n      thousandSeparator: this.thousandSeparator,\n      locale: this.olocale\n    };\n\n    if (this.step === undefined) {\n      this.step = 1;\n    }\n  }\n\n  ngAfterViewInit(): void {\n    super.ngAfterViewInit();\n  }\n\n  setData(value: any) {\n    super.setData(value);\n    setTimeout(() => {\n      this.setPipeValue();\n    }, 0);\n  }\n\n  setValue(val: any, options?: IFormValueOptions) {\n    super.setValue(val, options);\n    this.setPipeValue();\n  }\n\n  innerOnFocus(event: any) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (this.isReadOnly) {\n      return;\n    }\n    this.setNumberDOMValue(this.getValue());\n    super.innerOnFocus(event);\n  }\n\n  innerOnBlur(event?: any) {\n    if (event) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n    if (this.isReadOnly) {\n      return;\n    }\n    this.setPipeValue();\n    const formControl: FormControl = this.getControl();\n    if (formControl) {\n      formControl.updateValueAndValidity();\n    }\n    super.innerOnBlur(event);\n  }\n\n  setPipeValue() {\n    if (typeof this.pipeArguments !== 'undefined' && !this.isEmpty()) {\n      const parsedValue = this.componentPipe.transform(this.getValue(), this.pipeArguments);\n      this.setTextDOMValue(parsedValue);\n    }\n  }\n\n  isEmpty(): boolean {\n    if (this.value instanceof OFormValue) {\n      if (this.value.value !== undefined) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  getInputEl() {\n    let inputElement;\n    if (this.elRef.nativeElement.tagName === 'INPUT') {\n      inputElement = this.elRef.nativeElement;\n    } else {\n      inputElement = this.elRef.nativeElement.getElementsByTagName('INPUT')[0];\n    }\n    return inputElement;\n  }\n\n  setNumberDOMValue(val: any) {\n    const inputElement = this.getInputEl();\n    if (Util.isDefined(inputElement)) {\n      // Firefox workaround\n      if (navigator.userAgent.toLowerCase().indexOf('firefox') === -1) {\n        inputElement.type = 'number';\n      }\n      inputElement.value = (val !== undefined) ? val : '';\n    }\n  }\n\n  setTextDOMValue(val: any) {\n    const inputElement = this.getInputEl();\n    if (Util.isDefined(inputElement)) {\n      // Firefox workaround\n      if (navigator.userAgent.toLowerCase().indexOf('firefox') === -1) {\n        inputElement.type = 'text';\n      }\n      inputElement.value = (val !== undefined) ? val : '';\n    }\n  }\n\n  resolveValidators(): ValidatorFn[] {\n    const validators: ValidatorFn[] = super.resolveValidators();\n    if (Util.isDefined(this.min)) {\n      validators.push(this.minValidator.bind(this));\n    }\n    if (Util.isDefined(this.max)) {\n      validators.push(this.maxValidator.bind(this));\n    }\n    return validators;\n  }\n\n  protected minValidator(control: FormControl): ValidationErrors {\n    if ((typeof (control.value) === 'number') && (control.value < this.min)) {\n      return {\n        min: {\n          requiredMin: this.min\n        }\n      };\n    }\n    return {};\n  }\n\n  protected maxValidator(control: FormControl): ValidationErrors {\n    if ((typeof (control.value) === 'number') && (this.max < control.value)) {\n      return {\n        max: {\n          requiredMax: this.max\n        }\n      };\n    }\n    return {};\n  }\n\n  protected initializeStep(): void {\n    if (this.step <= 0) {\n      this.step = 1;\n      console.warn('`step` attribute must be greater than zero');\n    }\n  }\n\n}\n\n@NgModule({\n  declarations: [OIntegerInputComponent],\n  imports: [CommonModule, OSharedModule, OTextInputModule],\n  exports: [OIntegerInputComponent, OTextInputModule]\n})\nexport class OIntegerInputModule { }\n"]}