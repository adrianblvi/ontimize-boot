{"version":3,"file":"o-context-menu.service.js","sourceRoot":"","sources":["../../../../tmp/ontimize/components/contextmenu/o-context-menu.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Overlay, OverlayRef, ScrollStrategyOptions } from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { ComponentRef, ElementRef, Injectable, OnDestroy, QueryList } from '@angular/core';\nimport { Subject, Subscription } from 'rxjs';\n\nimport { OContextMenuContentComponent } from './context-menu/o-context-menu-content.component';\nimport { OComponentMenuItems } from './o-content-menu.class';\nimport { OContextMenuComponent } from './o-context-menu.component';\n\nexport interface IOContextMenuClickEvent {\n  anchorElement?: ElementRef;\n  contextMenu?: OContextMenuComponent;\n  event?: MouseEvent;\n  data?: any;\n}\n\nexport interface IOContextMenuContext extends IOContextMenuClickEvent {\n  menuItems?: QueryList<OComponentMenuItems>;\n  class?: string;\n}\n\n@Injectable()\nexport class OContextMenuService implements OnDestroy {\n\n  public showContextMenu: Subject<IOContextMenuClickEvent> = new Subject<IOContextMenuClickEvent>();\n  public closeContextMenu: Subject<Event> = new Subject();\n  public activeMenu: OContextMenuContentComponent;\n\n  protected overlays: OverlayRef[] = [];\n  protected fakeElement: any = {\n    getBoundingClientRect: (): ClientRect => ({\n      bottom: 0,\n      height: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      width: 0,\n    })\n  };\n  protected subscription: Subscription = new Subscription();\n\n  constructor(\n    private overlay: Overlay,\n    private scrollStrategy: ScrollStrategyOptions\n  ) {\n    this.subscription.add(this.closeContextMenu.subscribe(() => this.destroyOverlays()));\n  }\n\n  public ngOnDestroy(): void {\n    this.subscription.unsubscribe();\n  }\n\n  public openContextMenu(context: IOContextMenuContext): void {\n    this.destroyOverlays();\n    this.createOverlay(context);\n  }\n\n  public destroyOverlays(): void {\n    if (this.overlays) {\n      this.overlays.forEach((overlay, index) => {\n        overlay.detach();\n        overlay.dispose();\n      });\n    }\n    this.overlays = [];\n\n    if (this.activeMenu) {\n      this.activeMenu.close();\n    }\n  }\n\n  // Create overlay and attach `o-context-menu-content` to it in order to trigger the menu click, the menu opens in a new overlay\n  // TODO: try to use only one overlay\n  protected createOverlay(context: IOContextMenuContext): void {\n    context.event.preventDefault();\n    context.event.stopPropagation();\n\n    this.fakeElement.getBoundingClientRect = (): ClientRect => ({\n      bottom: context.event.clientY,\n      height: 0,\n      left: context.event.clientX,\n      right: context.event.clientX,\n      top: context.event.clientY,\n      width: 0,\n    });\n    const positionStrategy = this.overlay.position()\n      .flexibleConnectedTo(context.anchorElement || this.fakeElement)\n      .withPositions([{\n        overlayX: 'start',\n        overlayY: 'top',\n        originX: 'start',\n        originY: 'bottom'\n      }]);\n\n    const overlayRef = this.overlay.create({\n      positionStrategy: positionStrategy,\n      hasBackdrop: false,\n      panelClass: ['o-context-menu'],\n      scrollStrategy: this.scrollStrategy.close()\n    });\n\n    this.overlays = [overlayRef];\n\n    this.attachContextMenu(this.overlays[0], context);\n  }\n\n  protected attachContextMenu(overlay: OverlayRef, context: IOContextMenuContext): void {\n    const contextMenuContent: ComponentRef<any> = overlay.attach(new ComponentPortal(OContextMenuContentComponent));\n    contextMenuContent.instance.overlay = overlay;\n    contextMenuContent.instance.menuItems = context.menuItems;\n    contextMenuContent.instance.data = context.data;\n    contextMenuContent.instance.menuClass = context.class;\n  }\n\n}\n"]}