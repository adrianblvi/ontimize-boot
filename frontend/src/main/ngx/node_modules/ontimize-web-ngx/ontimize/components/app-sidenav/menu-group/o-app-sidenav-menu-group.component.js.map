{"version":3,"file":"o-app-sidenav-menu-group.component.js","sourceRoot":"","sources":["../../../../../tmp/ontimize/components/app-sidenav/menu-group/o-app-sidenav-menu-group.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { AfterViewInit, ChangeDetectorRef, ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Injector, NgModule, OnDestroy, ViewEncapsulation, OnInit } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { trigger, state, style, transition, animate } from '@angular/animations';\nimport { Subscription } from 'rxjs';\n\nimport { Util } from '../../../utils';\nimport { OSharedModule } from '../../../shared';\nimport { InputConverter } from '../../../decorators';\nimport { PermissionsUtils } from '../../../util/permissions';\nimport { OAppSidenavComponent } from '../o-app-sidenav.component';\nimport { AppMenuService, MenuGroup, OTranslateService, PermissionsService, OPermissions } from '../../../services';\nimport { OAppSidenavMenuItemModule } from '../menu-item/o-app-sidenav-menu-item.component';\n\nexport const DEFAULT_INPUTS_O_APP_SIDENAV_MENU_GROUP = [\n  'menuGroup : menu-group',\n  'sidenavOpened : sidenav-opened'\n];\n\nexport const DEFAULT_OUTPUTS_O_APP_SIDENAV_MENU_GROUP = [\n  'onItemClick'\n];\n\n@Component({\n  moduleId: module.id,\n  selector: 'o-app-sidenav-menu-group',\n  inputs: DEFAULT_INPUTS_O_APP_SIDENAV_MENU_GROUP,\n  outputs: DEFAULT_OUTPUTS_O_APP_SIDENAV_MENU_GROUP,\n  template: `\n    <ng-container *ngIf=\"!hidden\">\n      <button type=\"button\" mat-button class=\"o-app-sidenav-item o-app-sidenav-menugroup\" [class.active]=\"menuGroup.opened\"\n        fxLayout=\"column\" (click)=\"onClick()\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxFill>\n          <ng-container *ngIf=\"sidenavOpened\">\n            <mat-icon *ngIf=\"menuGroup.icon\">{{ menuGroup.icon }}</mat-icon>\n            <h3>{{ menuGroup.name | oTranslate }}</h3>\n            <span class=\"fill-remaining\"></span>\n            <mat-icon class=\"o-app-sidenav-menugroup-arrow\" svgIcon=\"ontimize:keyboard_arrow_right\"></mat-icon>\n          </ng-container>\n          <ng-container *ngIf=\"!sidenavOpened\">\n            <mat-icon [matTooltip]=\"tooltip\" matTooltipClass=\"menugroup-tooltip\" matTooltipPosition=\"right\" *ngIf=\"menuGroup.icon\">{{\n              menuGroup.icon }}</mat-icon>\n          </ng-container>\n        </div>\n      </button>\n\n      <div class=\"o-app-sidenav-menugroup-items-container\">\n        <ul [@contentExpansion]=\"contentExpansion\" class=\"o-app-sidenav-menugroup-ul\">\n          <ng-container *ngFor=\"let menuItem of menuGroup.items\">\n            <o-app-sidenav-menu-item [sidenav-opened]=\"sidenavOpened\" [disabled]=\"disabled\" [menu-item]=\"menuItem\"\n              [menu-item-type]=\"appMenuService.getMenuItemType(menuItem)\" (onClick)=\"onMenuItemClick($event)\">\n            </o-app-sidenav-menu-item>\n          </ng-container>\n        </ul>\n      </div>\n    </ng-container>\n  `,\n  styles: [`\n    .o-app-sidenav-menu-group .o-app-sidenav-menugroup{width:100%}.o-app-sidenav-menu-group[disabled=true] .o-app-sidenav-menugroup{cursor:default}.o-app-sidenav-menu-group .mat-tooltip.menugroup-tooltip{margin-left:28px}\n  `],\n  encapsulation: ViewEncapsulation.None,\n  animations: [\n    trigger('contentExpansion', [\n      state('collapsed', style({ height: '0px' })),\n      state('expanded', style({ height: '*' })),\n      transition('collapsed => expanded', animate('200ms ease-in')),\n      transition('expanded => collapsed', animate('200ms ease-out'))\n    ])\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  host: {\n    '[class]': 'getClass()',\n    '[attr.disabled]': 'disabled'\n  }\n})\nexport class OAppSidenavMenuGroupComponent implements OnInit, AfterViewInit, OnDestroy {\n\n  public static DEFAULT_INPUTS_O_APP_SIDENAV_MENU_GROUP = DEFAULT_INPUTS_O_APP_SIDENAV_MENU_GROUP;\n  public static DEFAULT_OUTPUTS_O_APP_SIDENAV_MENU_GROUP = DEFAULT_OUTPUTS_O_APP_SIDENAV_MENU_GROUP;\n\n  public onItemClick: EventEmitter<any> = new EventEmitter<any>();\n\n  protected translateService: OTranslateService;\n  protected permissionsService: PermissionsService;\n\n  appMenuService: AppMenuService;\n  protected sidenav: OAppSidenavComponent;\n  protected sidenavSubscription: Subscription;\n  protected permissions: OPermissions;\n  protected mutationObserver: MutationObserver;\n\n  public menuGroup: MenuGroup;\n\n  @InputConverter()\n  sidenavOpened: boolean = true;\n\n  hidden: boolean;\n  disabled: boolean;\n  protected _contentExpansion;\n\n  constructor(\n    protected injector: Injector,\n    protected elRef: ElementRef,\n    protected cd: ChangeDetectorRef\n  ) {\n    this.translateService = this.injector.get(OTranslateService);\n    this.appMenuService = this.injector.get(AppMenuService);\n    this.permissionsService = this.injector.get(PermissionsService);\n\n    this.sidenav = this.injector.get(OAppSidenavComponent);\n  }\n\n  ngOnInit() {\n    this.parsePermissions();\n  }\n\n  ngAfterViewInit() {\n    if (this.menuGroup.id === 'user-info') {\n      const self = this;\n      this.sidenavSubscription = this.sidenav.sidenav.openedChange.subscribe((opened) => {\n        self.disabled = !!(!opened || (self.permissions && self.permissions.enabled === false));\n        self.updateContentExpansion();\n        self.cd.markForCheck();\n      });\n    }\n    this.updateContentExpansion();\n  }\n\n  ngOnDestroy() {\n    if (this.sidenavSubscription) {\n      this.sidenavSubscription.unsubscribe();\n    }\n  }\n\n  protected parsePermissions() {\n    // if oattr in form, it can have permissions\n    this.permissions = this.permissionsService.getMenuPermissions(this.menuGroup.id);\n    if (!Util.isDefined(this.permissions)) {\n      return;\n    }\n    this.hidden = this.permissions.visible === false;\n    this.disabled = this.permissions.enabled === false;\n\n    if (this.disabled) {\n      this.mutationObserver = PermissionsUtils.registerDisabledChangesInDom(this.elRef.nativeElement, {\n        checkStringValue: true\n      });\n    }\n  }\n\n  onClick() {\n    if (this.disabled) {\n      return;\n    }\n    this.menuGroup.opened = !this.menuGroup.opened;\n    this.updateContentExpansion();\n  }\n\n  updateContentExpansion() {\n    let isOpened = this.menuGroup && this.menuGroup.opened;\n    if (this.menuGroup.id === 'user-info') {\n      isOpened = (this.sidenav && this.sidenav.sidenav.opened) && isOpened;\n    }\n    this.contentExpansion = isOpened ? 'expanded' : 'collapsed';\n  }\n\n  get contentExpansion(): string {\n    return this._contentExpansion;\n  }\n\n  set contentExpansion(val: string) {\n    this._contentExpansion = val;\n    this.cd.detectChanges();\n  }\n\n  get tooltip() {\n    let result = this.translateService.get(this.menuGroup.name);\n    if (Util.isDefined(this.menuGroup.tooltip)) {\n      result += ': ' + this.translateService.get(this.menuGroup.tooltip);\n    }\n    return result;\n  }\n\n  onMenuItemClick(e: Event): void {\n    this.onItemClick.emit(e);\n  }\n\n  getClass() {\n    let className = 'o-app-sidenav-menu-group';\n    if (this.menuGroup.class) {\n      className += ' ' + this.menuGroup.class;\n    }\n    return className;\n  }\n}\n\n@NgModule({\n  imports: [CommonModule, OAppSidenavMenuItemModule, OSharedModule],\n  declarations: [OAppSidenavMenuGroupComponent],\n  exports: [OAppSidenavMenuGroupComponent]\n})\nexport class OAppSidenavMenuGroupModule { }\n"]}