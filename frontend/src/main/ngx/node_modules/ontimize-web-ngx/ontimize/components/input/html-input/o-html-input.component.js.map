{"version":3,"file":"o-html-input.component.js","sourceRoot":"","sources":["../../../../../tmp/ontimize/components/input/html-input/o-html-input.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { AfterViewInit, ChangeDetectorRef, Component, ElementRef, Injector, NgModule, ViewChild } from '@angular/core';\nimport { animate, state, style, transition, trigger } from '@angular/animations';\nimport { CommonModule } from '@angular/common';\nimport { ValidatorFn, Validators } from '@angular/forms';\nimport { MatTab, MatTabGroup } from '@angular/material';\n\nimport { OSharedModule } from '../../../shared/shared.module';\nimport { NumberConverter } from '../../../decorators';\nimport { OFormComponent } from '../../form/form-components';\nimport { CKEditorComponent, CKEditorModule } from '../../material/ckeditor/ck-editor.component';\nimport { OFormDataComponent, DEFAULT_INPUTS_O_FORM_DATA_COMPONENT } from '../../o-form-data-component.class';\n\nexport const DEFAULT_INPUTS_O_HTML_INPUT = [\n  'oattr: attr',\n  'data',\n  'autoBinding: automatic-binding',\n  'autoRegistering: automatic-registering',\n  'orequired: required',\n  'minLength: min-length',\n  'maxLength: max-length',\n  'readOnly: read-only',\n  'sqlType: sql-type'\n];\n\nexport const DEFAULT_OUTPUTS_O_HTML_INPUT = [\n  ...DEFAULT_INPUTS_O_FORM_DATA_COMPONENT,\n  'onFocus',\n  'onBlur'\n];\n\n@Component({\n  moduleId: module.id,\n  selector: 'o-html-input',\n  template: `\n    <div [formGroup]=\"getFormGroup()\" class=\"mat-form-field mat-form-field\" fxFill>\n      <div class=\"mat-form-field-wrapper mat-form-field-wrapper\">\n        <ck-editor #ckEditor [id]=\"getAttribute()\" [formControlName]=\"getAttribute()\" (focus)=\"innerOnFocus($event)\" (blur)=\"innerOnBlur($event)\" \n        (change)=\"onChangeEvent($event)\"  [required]=\"isRequired\" [readonly]=\"isReadOnly\" class=\"mat-form-field-flex mat-form-field-flex\" fxFill></ck-editor>\n        <div class=\"mat-form-field-subscript-wrapper mat-form-field-subscript-wrapper\">\n          <div class=\"ng-trigger ng-trigger-transitionMessages\" [@transitionMessages]=\"_subscriptAnimationState\">\n            <mat-error *ngIf=\"hasError('required')\" text=\"{{ 'FORM_VALIDATION.REQUIRED' | oTranslate }}\"></mat-error>\n            <mat-error *ngIf=\"hasError('minlength')\" text=\"{{ 'FORM_VALIDATION.MIN_LENGTH' | oTranslate }}: {{\n              getErrorValue('minlength', 'requiredLength') }}\"></mat-error>\n            <mat-error *ngIf=\"hasError('maxlength')\" text=\"{{ 'FORM_VALIDATION.MAX_LENGTH' | oTranslate }}: {{\n              getErrorValue('maxlength', 'requiredLength') }}\"></mat-error>\n            <mat-error *ngFor=\"let oError of getActiveOErrors()\"> {{ oError.text | oTranslate }} \"></mat-error>\n          </div>\n        </div>\n      </div>\n    </div>\n  `,\n  styles: [`\n    .mat-form-field-wrapper{position:relative}.mat-form-field-subscript-wrapper{position:absolute;width:100%;overflow:hidden}\n  `],\n  inputs: DEFAULT_INPUTS_O_HTML_INPUT,\n  outputs: DEFAULT_OUTPUTS_O_HTML_INPUT,\n  animations: [\n    trigger('transitionMessages', [\n      state('enter', style({ opacity: 1, transform: 'translateY(0%)' })),\n      transition('void => enter', [\n        style({ opacity: 0, transform: 'translateY(-100%)' }),\n        animate('300ms cubic-bezier(0.55, 0, 0.55, 0.2)'),\n      ]),\n    ])\n  ]\n})\nexport class OHTMLInputComponent extends OFormDataComponent implements AfterViewInit {\n\n  public static DEFAULT_INPUTS_O_HTML_INPUT = DEFAULT_INPUTS_O_HTML_INPUT;\n  public static DEFAULT_OUTPUTS_O_HTML_INPUT = DEFAULT_OUTPUTS_O_HTML_INPUT;\n\n  protected _minLength: number = -1;\n  protected _maxLength: number = -1;\n\n  @ViewChild('ckEditor') ckEditor: CKEditorComponent;\n\n  protected tabGroupContainer: MatTabGroup;\n  protected tabContainer: MatTab;\n\n  /** State of the mat-hint and mat-error animations. */\n  _subscriptAnimationState: string = '';\n\n  protected _changeDetectorRef: ChangeDetectorRef;\n\n  constructor(\n    form: OFormComponent,\n    elRef: ElementRef,\n    injector: Injector\n  ) {\n    super(form, elRef, injector);\n    this.form = form;\n    this.elRef = elRef;\n    this._changeDetectorRef = this.injector.get(ChangeDetectorRef);\n    try {\n      this.tabGroupContainer = this.injector.get(MatTabGroup);\n      this.tabContainer = this.injector.get(MatTab);\n    } catch (error) {\n      // Do nothing due to not always is contained on tab.\n    }\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n    if (this.form) {\n      var self = this;\n      this.form.beforeCloseDetail.subscribe((evt: any) => {\n        self.destroyCKEditor();\n      });\n      this.form.beforeGoEditMode.subscribe((evt: any) => {\n        self.destroyCKEditor();\n      });\n    }\n\n    if (this.tabGroupContainer) {\n      this.tabGroupContainer.selectedTabChange.subscribe((evt: any) => {\n        self.destroyCKEditor();\n        if (self.isInActiveTab()) {\n          self.ckEditor.initCKEditor(self.oattr);\n        }\n      });\n    }\n  }\n\n  ngAfterViewInit() {\n    super.ngAfterViewInit();\n    // Avoid animations on load.\n    this._subscriptAnimationState = 'enter';\n    this._changeDetectorRef.detectChanges();\n  }\n\n\n  hasError(error: string): boolean {\n    let result = super.hasError(error);\n    this._subscriptAnimationState = result ? 'enter' : 'void';\n    return result;\n  }\n\n  isInActiveTab(): boolean {\n    var result: boolean = !(this.tabGroupContainer && this.tabContainer);\n    if (!result) {\n      var self = this;\n      this.tabGroupContainer._tabs.forEach(function (tab, index) {\n        if (tab === self.tabContainer) {\n          result = (self.tabGroupContainer.selectedIndex === index);\n        }\n      });\n    }\n    return result;\n  }\n\n  resolveValidators(): ValidatorFn[] {\n    let validators: ValidatorFn[] = super.resolveValidators();\n    if (this.minLength >= 0) {\n      validators.push(Validators.minLength(this.minLength));\n    }\n    if (this.maxLength >= 0) {\n      validators.push(Validators.maxLength(this.maxLength));\n    }\n    return validators;\n  }\n\n  clearValue(): void {\n    super.clearValue();\n    this.ckEditor.instance.updateElement();\n    this.ckEditor.instance.setData('');\n  }\n\n  destroyCKEditor() {\n    if (this.ckEditor) {\n      this.ckEditor.destroyCKEditor();\n    }\n  }\n\n  getCKEditor(): any {\n    return this.ckEditor.instance;\n  }\n\n  set minLength(val: number) {\n    const old = this._minLength;\n    this._minLength = NumberConverter(val);\n    if (val !== old) {\n      this.updateValidators();\n    }\n  }\n\n  get minLength(): number {\n    return this._minLength;\n  }\n\n  set maxLength(val: number) {\n    const old = this._maxLength;\n    this._maxLength = NumberConverter(val);\n    if (val !== old) {\n      this.updateValidators();\n    }\n  }\n\n  get maxLength(): number {\n    return this._maxLength;\n  }\n}\n\n@NgModule({\n  declarations: [OHTMLInputComponent],\n  imports: [CKEditorModule, CommonModule, OSharedModule],\n  exports: [OHTMLInputComponent]\n})\nexport class OHTMLInputModule { }\n"]}