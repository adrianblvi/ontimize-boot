{"version":3,"file":"o-table-row.directive.js","sourceRoot":"","sources":["../../../../../../tmp/ontimize/components/table/extensions/row/o-table-row.directive.ts"],"names":[],"mappings":"AAAA,OAAO,EAAiB,UAAU,EAAE,MAAM,EAAE,UAAU,EAAa,SAAS,EAAE,SAAS,EAAE,MAAM,eAAe,CAAC;AAE/G,OAAO,EAAE,eAAe,EAAE,MAAM,yBAAyB,CAAC;AAE1D;IAME,4BACoD,KAAsB,EAC9D,UAAsB,EACtB,QAAmB;QAFqB,UAAK,GAAL,KAAK,CAAiB;QAC9D,eAAU,GAAV,UAAU,CAAY;QACtB,aAAQ,GAAR,QAAQ,CAAW;IAE/B,CAAC;IAED,4CAAe,GAAf;QACE,IAAI,CAAC,cAAc,EAAE,CAAC;IACxB,CAAC;IAED,wCAAW,GAAX;QACE,IAAI,IAAI,CAAC,kBAAkB,EAAE;YAC3B,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,CAAC;SACvC;IACH,CAAC;IAED,2CAAc,GAAd;QACE,IAAI,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE;YAC/B,IAAM,MAAI,GAAG,IAAI,CAAC;YAClB,IAAI,CAAC,KAAK,CAAC,qBAAqB,CAAC,SAAS,CAAC,UAAA,QAAQ;gBACjD,UAAU,CAAC;oBACT,IAAI,QAAQ,EAAE;wBACZ,MAAI,CAAC,iBAAiB,EAAE,CAAC;qBAC1B;yBAAM;wBACL,MAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;qBAC7B;gBACH,CAAC,EAAE,CAAC,CAAC,CAAC;YACR,CAAC,CAAC,CAAC;SACJ;IACH,CAAC;IAED,8CAAiB,GAAjB;QACE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE;YAChC,OAAO;SACR;QACD,IAAI,IAAI,CAAC,eAAe,EAAE;YACxB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;SACvC;QACD,IAAI,UAAU,GAAW,CAAC,CAAC;QAC3B,IAAI;YACF,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,OAAO;gBACtD,IAAI,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,WAAW,EAAE,KAAK,UAAU,EAAE;oBAC9E,UAAU,IAAI,OAAO,CAAC,WAAW,CAAC;iBACnC;YACH,CAAC,CAAC,CAAC;SACJ;QAAC,OAAO,KAAK,EAAE;SAEf;QACD,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,UAAU,GAAG,CAAC,EAAE;YACxC,UAAU,IAAI,EAAE,CAAC;YACjB,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;SAC9B;IACH,CAAC;IAED,wCAAW,GAAX,UAAY,KAAa;QACvB,IAAM,UAAU,GAAG,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;QAC/D,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;QAC3E,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;IAC9B,CAAC;IAED,sBAAI,+CAAe;aAAnB;YACE,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,KAAK,SAAS,CAAC;QAC3C,CAAC;;;OAAA;;gBArEF,SAAS,SAAC;oBACT,QAAQ,EAAE,aAAa;iBACxB;;;gBAJQ,eAAe,uBASnB,MAAM,SAAC,UAAU,CAAC,cAAM,OAAA,eAAe,EAAf,CAAe,CAAC;gBAXD,UAAU;gBAAa,SAAS;;IA2E5E,yBAAC;CAAA,AAvED,IAuEC;SApEY,kBAAkB","sourcesContent":["import { AfterViewInit, forwardRef, Inject, ElementRef, OnDestroy, Renderer2, Directive } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { OTableComponent } from '../../o-table.component';\n\n@Directive({\n  selector: '[oTableRow]'\n})\nexport class OTableRowDirective implements AfterViewInit, OnDestroy {\n  protected resizeSubscription: Subscription;\n\n  constructor(\n    @Inject(forwardRef(() => OTableComponent)) public table: OTableComponent,\n    protected elementRef: ElementRef,\n    protected renderer: Renderer2\n  ) {\n  }\n\n  ngAfterViewInit() {\n    this.registerResize();\n  }\n\n  ngOnDestroy(): void {\n    if (this.resizeSubscription) {\n      this.resizeSubscription.unsubscribe();\n    }\n  }\n\n  registerResize() {\n    if (this.table.horizontalScroll) {\n      const self = this;\n      this.table.onUpdateScrolledState.subscribe(scrolled => {\n        setTimeout(function () {\n          if (scrolled) {\n            self.calculateRowWidth();\n          } else {\n            self.setRowWidth(undefined);\n          }\n        }, 0);\n      });\n    }\n  }\n\n  calculateRowWidth() {\n    if (!this.table.horizontalScroll) {\n      return;\n    }\n    if (this.alreadyScrolled) {\n      this.setRowWidth(this.table.rowWidth);\n    }\n    let totalWidth: number = 0;\n    try {\n      this.elementRef.nativeElement.childNodes.forEach(element => {\n        if (element && element.tagName && element.tagName.toLowerCase() === 'mat-cell') {\n          totalWidth += element.clientWidth;\n        }\n      });\n    } catch (error) {\n      //\n    }\n    if (!isNaN(totalWidth) && totalWidth > 0) {\n      totalWidth += 48;\n      this.setRowWidth(totalWidth);\n    }\n  }\n\n  setRowWidth(value: number) {\n    const widthValue = value !== undefined ? value + 'px' : 'auto';\n    this.renderer.setStyle(this.elementRef.nativeElement, 'width', widthValue);\n    this.table.rowWidth = value;\n  }\n\n  get alreadyScrolled(): boolean {\n    return this.table.rowWidth !== undefined;\n  }\n\n}\n"]}