{"version":3,"file":"ck-editor.component.js","sourceRoot":"","sources":["../../../../../tmp/ontimize/components/material/ckeditor/ck-editor.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { AfterViewInit, Component, ElementRef, EventEmitter, forwardRef, Input, NgModule, NgZone, OnDestroy, Output, ViewChild } from '@angular/core';\nimport { ControlValueAccessor, FormsModule, NG_VALUE_ACCESSOR } from '@angular/forms';\n\nimport { Util } from '../../../util/util';\n\ndeclare var CKEDITOR: any;\n\nconst defaults = {\n  contentsCss: [''],\n  customConfig: ''\n};\n\n@Component({\n  moduleId: module.id,\n  selector: 'ck-editor',\n  template: `<textarea #ck></textarea>`,\n  providers: [{\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => CKEditorComponent),\n    multi: true\n  }],\n  exportAs: 'ckEditor'\n})\nexport class CKEditorComponent implements AfterViewInit, OnDestroy, ControlValueAccessor {\n\n  protected ckIns: any;\n  protected identifier: string;\n  protected innerValue: string = '';\n\n  public get instance() {\n    return this.ckIns;\n  }\n\n  protected _readonly: boolean = false;\n\n  @Input()\n  set readonly(value: boolean) {\n    this._readonly = value;\n    setTimeout(() => {\n      if (Util.isDefined(this.ckIns) && Util.isDefined(this.ckIns.editable())) {\n        this.ckIns.setReadOnly(this.readonly);\n      }\n    });\n  }\n\n  get readonly(): boolean {\n    return this._readonly;\n  }\n\n  @Input() public config: any = {};\n  @Input() public skin: string = 'moono-lisa';\n  @Input() public language: string = 'en';\n  @Input() public fullPage: boolean = false;\n  @Input() public inline: boolean = false;\n  @Input() public id: string;\n\n  @Output() change = new EventEmitter();\n  @Output() ready = new EventEmitter();\n  @Output() blur = new EventEmitter();\n  @Output() focus = new EventEmitter();\n\n  @ViewChild('ck') public ck: ElementRef;\n\n  constructor(\n    protected ngZone: NgZone\n  ) { }\n\n  protected static getRandomIdentifier(id: string = '') {\n    return 'editor-' + (id !== '' ? id : Math.round(Math.random() * 100000000));\n  }\n\n  ngOnDestroy() {\n    this.destroyCKEditor();\n  }\n\n  ngAfterViewInit() {\n    this.destroyCKEditor();\n    this.initCKEditor(CKEditorComponent.getRandomIdentifier(this.id));\n  }\n\n  public initCKEditor(identifier: string) {\n    if (typeof CKEDITOR === 'undefined') {\n      return console.warn('CKEditor 4.x is missing (http://ckeditor.com/)');\n    }\n\n    this.identifier = identifier;\n    this.ck.nativeElement.setAttribute('name', this.identifier);\n\n    const opt = Object.assign({}, defaults, this.config, {\n      readOnly: this.readonly,\n      skin: this.skin,\n      language: this.language,\n      fullPage: this.fullPage,\n      inline: this.inline,\n      width: '100%'\n    });\n    this.ckIns = this.inline\n      ? CKEDITOR.inline(this.ck.nativeElement, opt)\n      : CKEDITOR.replace(this.ck.nativeElement, opt);\n    this.ckIns.setData(this.innerValue);\n\n    this.ckIns.on('change', () => {\n      const val = this.ckIns.getData();\n      this.updateValue(val);\n    });\n\n    this.ckIns.on('instanceReady', (evt: any) => {\n      this.ngZone.run(() => {\n        this.ready.emit(evt);\n      });\n    });\n\n    this.ckIns.on('blur', (evt: any) => {\n      this.ngZone.run(() => {\n        this.blur.emit(evt);\n        this.propagateTouch();\n      });\n    });\n\n    this.ckIns.on('focus', (evt: any) => {\n      this.ngZone.run(() => {\n        this.focus.emit(evt);\n      });\n    });\n  }\n\n  public destroyCKEditor() {\n    if (this.ckIns) {\n      this.ckIns.removeAllListeners();\n      if (CKEDITOR.instances.hasOwnProperty(this.ckIns.name)) {\n        CKEDITOR.remove(CKEDITOR.instances[this.ckIns.name]);\n      }\n      this.ckIns.destroy();\n      this.ckIns = null;\n      const editorEl = document.querySelector('#cke_' + this.identifier);\n      if (Util.isDefined(editorEl) && Util.isDefined(editorEl.parentElement)) {\n        editorEl.parentElement.removeChild(editorEl);\n      }\n    }\n  }\n\n  protected updateValue(value: string) {\n    this.ngZone.run(() => {\n      this.innerValue = value;\n      this.propagateChange(value);\n      this.propagateTouch();\n      this.change.emit(value);\n    });\n  }\n\n  writeValue(value: any): void {\n    this.innerValue = value || '';\n    if (this.ckIns) {\n      // Fix bug that can't emit change event when set non-html tag value twice in fullpage mode.\n      this.ckIns.setData(this.innerValue);\n      const val = this.ckIns.getData();\n      this.ckIns.setData(val);\n    }\n  }\n\n  protected propagateChange(_: any) {\n    // do nothing\n  }\n\n  protected propagateTouch() {\n    // do nothing\n  }\n\n  registerOnChange(fn: any): void {\n    this.propagateChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.propagateTouch = fn;\n  }\n\n}\n\n@NgModule({\n  exports: [\n    FormsModule,\n    CKEditorComponent\n  ],\n  declarations: [CKEditorComponent]\n})\nexport class CKEditorModule { }\n"]}