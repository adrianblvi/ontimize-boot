{"version":3,"file":"o-form-layout-can-activate-child.guard.js","sourceRoot":"","sources":["../../../../../tmp/ontimize/layouts/form-layout/guards/o-form-layout-can-activate-child.guard.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAGrD,OAAO,EAAE,IAAI,EAAE,MAAM,gBAAgB,CAAC;AACtC,OAAO,EAAE,yBAAyB,EAAE,MAAM,iDAAiD,CAAC;AAC5F,OAAO,EAAE,4BAA4B,EAAE,MAAM,oDAAoD,CAAC;AAGlG;IAME,yCAAsB,QAAkB;QAAlB,aAAQ,GAAR,QAAQ,CAAU;QACtC,IAAI,CAAC,4BAA4B,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QACpF,IAAI;YACF,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;SACxE;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;SAClB;IACH,CAAC;IAED,0DAAgB,GAAhB,UAAiB,UAAkC,EAAE,KAA0B;QAC7E,IAAM,iBAAiB,GAAgC,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,CAAC;QACvG,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,GAAG,SAAS,CAAC;QAC5D,IAAI,iBAAiB,EAAE;YACrB,IAAM,WAAW,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;YACjF,IAAM,YAAY,GAAW,CAAC,WAAW,IAAI,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC;YACjE,IAAI,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,EAAE;gBAChC,IAAM,UAAU,GAAG,CAAC,IAAI,CAAC,4BAA4B,CAAC,gCAAgC,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;gBAC1G,IAAI,UAAU,EAAE;oBACd,OAAO,KAAK,CAAC;iBACd;aACF;YACD,iBAAiB,CAAC,kBAAkB,CAAC,UAAU,EAAE,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACjG,OAAO,KAAK,CAAC;SACd;QACD,OAAO,IAAI,CAAC;IACd,CAAC;;gBA/BF,UAAU;;;gBARU,QAAQ;;IAwC7B,sCAAC;CAAA,AAhCD,IAgCC;SA/BY,+BAA+B","sourcesContent":["import { Injectable, Injector } from '@angular/core';\nimport { CanActivateChild, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { Util } from '../../../utils';\nimport { OFormLayoutManagerService } from '../../../services/o-form-layout-manager.service';\nimport { ShareCanActivateChildService } from '../../../services/share-can-activate-child.service';\nimport { OFormLayoutManagerComponent } from '../o-form-layout-manager.component';\n\n@Injectable()\nexport class CanActivateFormLayoutChildGuard implements CanActivateChild {\n\n  protected oFormLayoutService: OFormLayoutManagerService;\n  protected shareCanActivateChildService: ShareCanActivateChildService;\n\n  constructor(protected injector: Injector) {\n    this.shareCanActivateChildService = this.injector.get(ShareCanActivateChildService);\n    try {\n      this.oFormLayoutService = this.injector.get(OFormLayoutManagerService);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  canActivateChild(childRoute: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean | Observable<boolean> | Promise<boolean> {\n    const formLayoutManager: OFormLayoutManagerComponent = this.oFormLayoutService.activeFormLayoutManager;\n    this.oFormLayoutService.activeFormLayoutManager = undefined;\n    if (formLayoutManager) {\n      const oPermission = childRoute.data ? childRoute.data['oPermission'] : undefined;\n      const permissionId: string = (oPermission || {})['permissionId'];\n      if (Util.isDefined(permissionId)) {\n        const restricted = !this.shareCanActivateChildService.canActivateChildUsingPermissions(childRoute, state);\n        if (restricted) {\n          return false;\n        }\n      }\n      formLayoutManager.addDetailComponent(childRoute, state.url.substring(0, state.url.indexOf('?')));\n      return false;\n    }\n    return true;\n  }\n}\n"]}